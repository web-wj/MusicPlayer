!function(s,e){function t(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.rotateTimer=null,this.curIndex=0,this.list=null,this.progress=e.progress.pro()}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json")},getDom:function(){this.record=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData:function(t){var i=this;s.ajax({url:t,method:"get",success:function(t){i.dataList=t,i.listPlay(),i.indexObj=new e.controlIndex(t.length),i.loadMusic(i.indexObj.index),i.musicControl(),i.dragProgress(),e.music.end(i.nextPlay)},error:function(){}})},loadMusic:function(t){e.render(this.dataList[t]),e.music.load(this.dataList[t].audioSrc),this.progress.renderAllTime(this.dataList[t].duration),"play"==e.music.status&&(e.music.play(),this.controlBtns[2].className="playing",this.imgRotate(0),this.progress.move(0)),this.list.changeSelect(t),this.curIndex=t},musicControl:function(){var i=this;this.controlBtns[0].addEventListener("touchend",function(){i.dataList[i.indexObj.index].isLike=!i.dataList[i.indexObj.index].isLike;var t=i.dataList[i.indexObj.index].isLike;document.querySelectorAll(".control li")[0].className=t?"liking":""}),this.controlBtns[1].addEventListener("touchend",function(){e.music.status="play",i.loadMusic(i.indexObj.prev())}),this.controlBtns[2].addEventListener("touchend",function(){var t;"play"==e.music.status?(e.music.pause(),this.className="",i.imgStop(),i.progress.stop()):(e.music.play(),this.className="playing",t=i.record.dataset.rotate||0,i.imgRotate(t),i.progress.move())}),this.controlBtns[3].addEventListener("touchend",function(){e.music.status="play",i.loadMusic(i.indexObj.next())})},imgRotate:function(t){var i=this;clearInterval(this.rotateTimer),this.rotateTimer=setInterval(function(){t=+t+.2,i.record.style.transform="rotate("+t+"deg)",i.record.dataset.rotate=t},1e3/60)},imgStop:function(){clearInterval(this.rotateTimer)},listPlay:function(){var s=this;this.list=e.listControl(this.dataList,this.wrap),this.controlBtns[4].addEventListener("touchend",function(){s.list.slideUp()}),this.list.musicList.forEach(function(t,i){t.addEventListener("touchend",function(){s.curIndex!=i&&(e.music.status="play",s.indexObj.index=i,s.loadMusic(i),s.list.slideDown())})})},dragProgress:function(){var s=this,t=e.progress.drag(this.progress.circle);t.init(),t.start=function(){},t.move=function(t){s.progress.update(t)},t.end=function(t){var i=t*s.dataList[s.indexObj.index].duration;e.music.playTo(i),s.progress.move(t),e.music.play(),s.controlBtns[2].className="playing";t=s.record.dataset.rotate||0;s.imgRotate(t)}},nextPlay:function(){e.music.status="play",this.loadMusic(this.indexObj.next())}},new t(document.getElementById("wrap")).init()}(window.Zepto,window.player);